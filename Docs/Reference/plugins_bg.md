# Справочник на Плъгините (Firmware Plugins)

Този документ описва наличните плъгини (допълнителни модули) в системата Hydroponics v5. Плъгините добавят специфична функционалност към фърмуера на контролера, като повишават надеждността, улесняват диагностиката или добавят нови комуникационни възможности.

## Какво е Плъгин?
Плъгинът е парче код, което се вгражда във фърмуера по време на генерирането му. За разлика от "Устройствата" (които са физически сензори или релета), плъгините са софтуерни разширения на системно ниво.

---

## 1. EEPROM State Save (Запазване на състоянието)
**Идентификатор:** `eeprom_state`  
**Категория:** Надеждност (Reliability)

### За какво служи?
Този плъгин гарантира, че състоянието на вашите релета и изпълнителни механизми ще се запази дори след спиране на тока или рестарт на контролера.

### Как работи?
1.  **Запис:** Всеки път, когато изпратите команда за промяна на състояние (напр. включване на лампа), плъгинът записва новото състояние (ON/OFF) в енергонезависимата памет (EEPROM) на контролера.
2.  **Възстановяване:** При стартиране на контролера, той автоматично прочита последното записано състояние за всеки пин и го възстановява.

### Изисквания
*   **Хардуер:** Работи на всички поддържани платки (Arduino Uno R3/R4, ESP8266, ESP32).
*   **Транспорт:** Няма специални изисквания.

### Тестване
Включете реле, дръпнете щепсела на контролера и го включете отново. Релето трябва да се включи само.

---

## 2. Watchdog Timer (Куче пазач)
**Идентификатор:** `watchdog_timer`  
**Категория:** Надеждност (Reliability)

### За какво служи?
Предпазва контролера от "забиване". Ако софтуерът спре да работи поради грешка, безкраен цикъл или хардуерен проблем, Watchdog-ът автоматично ще рестартира контролера.

### Как работи?
Това е хардуерен таймер, който брои назад (обикновено 8 секунди). Основният цикъл на програмата (`loop`) постоянно "рита" (нулира) този таймер. Ако програмата забие, тя спира да го нулира, таймерът стига до нула и предизвиква хардуерен рестарт.

### Параметри
*   **Timeout (ms):** Време за реакция (по подразбиране 8000ms / 8 секунди).

### Изисквания
*   **Хардуер:** Работи на всички поддържани платки.

### Тестване
Изпратете команда `TEST_WATCHDOG` през Serial или Telnet. Тя ще спре програмата за 10 секунди. Контролерът трябва да се рестартира сам около 8-мата секунда.

---

## 3. Remote Debug (Telnet)
**Идентификатор:** `remote_debug`  
**Категория:** Диагностика (Debugging)

### За какво служи?
Позволява ви да виждате системните съобщения (логове) и да изпращате команди към контролера безжично, без да е необходимо USB свързване.

### Как работи?
Стартира Telnet сървър на порт **23**. Можете да се свържете към IP адреса на контролера с програма като PuTTY (изберете Connection type: Telnet). Всичко, което се печата на Serial монитора, се дублира и към Telnet клиента.

### Изисквания
*   **Хардуер:** Изисква WiFi свързаност (ESP8266, ESP32, Arduino Uno R4 WiFi).
*   **Транспорт:** Работи само с `wifi` транспорт. Не е съвместим с Arduino Uno R3 (освен ако няма Ethernet shield, но текущата версия е за WiFi).

---

## 4. WiFi Failover (Резервна връзка)
**Идентификатор:** `wifi_failover`  
**Категория:** Свързаност (Connectivity)

### За какво служи?
Осигурява непрекъсната работа, като позволява на контролера да се свърже към втора (резервна) WiFi мрежа, ако основната отпадне.

### Как работи?
Ако връзката с основната мрежа (зададена в настройките на транспорта) се разпадне или не може да се осъществи, контролерът автоматично опитва да се свърже с резервната мрежа.

### Параметри
*   **Backup SSID:** Името на резервната мрежа.
*   **Backup Password:** Паролата за резервната мрежа.

### Изисквания
*   **Хардуер:** ESP8266, ESP32, Arduino Uno R4 WiFi.
*   **Транспорт:** `wifi`.

---

## 5. OTA Update (Update Over-The-Air)
**Идентификатор:** `ota_update`  
**Категория:** Поддръжка (Maintenance)

### За какво служи?
Позволява обновяване на фърмуера безжично, директно през WiFi мрежата, без нужда от USB кабел.

### Как работи?
Контролерът "слуша" за заявки за обновяване. През Arduino IDE (или друг инструмент) можете да изберете мрежовия порт на устройството и да качите новия код ("Upload").

### Изисквания
*   **Хардуер:** ESP8266, ESP32.
*   **Важно:** Все още НЕ се поддържа за Arduino Uno R4 WiFi (поради ограничения на библиотеките).
*   **Транспорт:** `wifi`.

---

## 6. mDNS Service (Bonjour / Zeroconf)
**Идентификатор:** `mdns_service`  
**Категория:** Мрежа (Network)

### За какво служи?
Позволява да достъпвате контролера по име (напр. `hydroponics.local`), вместо да помните IP адреса му (който може да се променя).

### Как работи?
Излъчва име в локалната мрежа. Това улеснява откриването на устройството от софтуера и от потребителя.

### Изисквания
*   **Хардуер:** ESP8266, ESP32.
*   **Важно:** Все още НЕ се поддържа стабилно за Arduino Uno R4 WiFi.
*   **Транспорт:** `wifi`.
